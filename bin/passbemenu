#!/bin/bash
# 
# Usage: passbemenu [command]
# Commands:
#   type
#   clipboard
# DEPS: ripgrep, pass, bemenu, wtype

MENU_CMD="bemenu --prompt pass"
PASSWORD_DIR="$HOME/.password-store"
TERMINAL_APP="foot bash -c"

command=$1
if [ -z "$command" ] ; then
  command=$(echo $'type\nclipboard' | $MENU_CMD)
fi
if [ -z "$command" ] ; then
  exit -1
fi


password_name=$(find $PASSWORD_DIR -name "*.gpg" -type f | rg -o -r '$1' '\.password-store/(.*)\.gpg$' | $MENU_CMD)

if [ -z "$password_name" ] ; then
  exit -1
fi


if [ "$command" = "type" ] ; then
  password=$("pass show \"$password_name\" | head -n 1") 

  wtype -- "$password" > /dev/null
fi

